This repository is for the computation of functional connectivities (covariance matrices) for patients in the HCP_1200 dataset. There are 1113 patients in the HCP_1200 dataset. A subset of them have at least one (of two possible) fmri scans for the REST1 portion of the dataset. Each available scan is parcelized according to an atlas (Deskian or Destreuix), activity values are averaged in these parcellizations for each time point thus creating a vector observation (each entry corresponds to a brain regions). These observations are then used to compute the overall covariance matrix.


Files with ** are the main files in this repo.

Need to change paths in most files to accomodate to users computer.

fc_processing/ ==> compute to fcs from the data
    compute_fcs.m **
        Script coordinating fc computation for all patients. Saves .mat for each patient with fc's and relavatn metadata
        Needs data files to run.
        Output of this script (for desikan atlas) can be found here: 
            https://drive.google.com/drive/folders/1LQocAEeEI02704KrmIior4HEcXx8KxSk?usp=sharing
    
    fmri_to_cov.m **
        Maps a single fmri scan (LR or RL) with its corresponding atlas raw to an fc.
        Needs raw data fmri/atlas files to run.
    
    sc_fc_dataset.m **
        Create large tensors of fcs, scs, and metadata into a .mat file
    
    transform_sc.m
        Maps from raw scs to transformed scs via log(raw_edge+1)

data/  ==> .mat files outputted and/or used by other scripts
    brain_dataset_fc_sc_pairs.mat
        Output of sc_fc_dataset.m
        Pairs of scs and fcs (covariances and correlations of all scans available - lr and rl in REST1)
        Tensors are of shape 87x87x1064. To access one matrix use: fcs(:,:,idx_of_interest)
            If a scan is not available, the matrix will be all NaNs
        Associated metadata included (atlas used, subject ids, etc)
        Invariant: All data in same order. The fcs(:,:,i) <==> scs(:,:,i) <==> final_subject_list(i)
        *Not included in git download (too large 380 MB).*
        Link to this file: https://drive.google.com/drive/folders/1LQocAEeEI02704KrmIior4HEcXx8KxSk?usp=sharing

    fc_and_sc_set.mat
        sets of patient id
            exist_any_fc_and_sc := patients with at least one fc (lr and/or rl) and an sc
            exist_both_fc_and_sc := patients with both fcs (lr and rl) and an sc
        exist_any_fc_and_sc is used at training set

    hcp_1200_subject_list.mat
        List of all subject on HCP_1200 aws s3 server.
        Includes all patients, regardless of what scans they have.

    subject_missing_fc_data.mat
        Set of patient ids
            missing_LR = all patients w/o an LR scan for REST1
            missing_RL = all patients w/o an RL scan for REST1
            missing_LR_and_RL = patients missing both LR and RL scans for REST1 (interesection of prev sets)
            type = string indicating which fmri data is being referenced

    correlations_desikan_old.mat
        1058 87x87 Correlation (not Covariance) matrices provided by Zhengwu to Yang, and from Yang to me.
        Unclear if these are if lr, rl, mean.
        Desikan atlas, subcortical nodes come LAST (69:87), corresponding patient ids in subject_list_sc
        Missing data for patients relative to scs_desikan.mat. Aka patients with scs but no fcs (here)
            patient ids of missing data                  <-> [150019, 160931, 173233, 179548, 351938, 693461, 995174]


    scs_desikan.mat
        1065 87x87 structural connectivities provided by Zhengwu.
        Desikan atlas, Subcortical nodes come FIRST (1-19), corresponding patient ids in subject_list_sc




misc/ ==> miscellaneos files for visualizing, analysing the data, and testing other scripts
    data_accounting.m **
        Analysis on what data we have for each patients, and which scans are needed
    
    test_dataset_creation.m
        Ensure data placed into dataset tensors properly by reloading the raw .mat file and comparing
    
    compare_datasets.m
        Plotting to compare old correlation fcs to new computed correlation fcs
        Outputs jpgs showing comparison for each patient
    
    inspect_given_scs.m
        Sanity checks on scs
    
    subject_list_dir_debug.m
        Found repeated subject in subject_list outputed by function in hcp-batch-download repo




Attributions
    Zhengwu Zhang - professor at UNC
    Martin Cole - phd student at UofR
    FieldTrip - use of cifti file reading libary - http://www.fieldtriptoolbox.org
    HCP - human connectome project - http://www.humanconnectome.org



======================================================
implimentation notes:

1)error when running correlation_calculation.,

“ft_getopt.mexmaci64” cannot be opened because the developer cannot be verified.

solution: 
https://www.fieldtriptoolbox.org/faq/mexmaci64_cannot_be_opened_because_the_developer_cannot_be_verified/



2) Atlas indices
-talked with Marty to find indices for Desikan and Destrieux
    -to get indices used for cortical/subcortical brain regions in atlas
        > unique(subjlab.x100206_aparc_a2009s(~isnan(subjlab.x100206_aparc_a2009s)))
    -run code, break point, open subjlab and subj_tdata and look at fields. brain_strcture and brain_structure_label??
    -use setdiff to find missing labels (corpus collosum)
-to confirm check file prrovided by Yang (load_brain_data_FC_SC.m)
    -load file
    -check variable: ChosenROI_cortical and ChosenROI_subcortical

